!function(t){t.TOC=function(n,e,o){var i=this;return i.$el=t(n),i.html="",i.init=function(){t.extend(o,i.$el.data());for(var n in o)o.hasOwnProperty(n)&&""==o[n]&&delete o[n];i.options=t.extend({},t.TOC.defaultOptions,o),(void 0===e||null==e)&&(e=document.body),(void 0===o||null==o)&&(o=""),i.options.nested=o.headings?!1:i.options.nested,i.options.startLevel=i.options.startLevel<1||i.options.startLevel>6?1:i.options.startLevel,i.options.depth=i.options.depth<1||i.options.depth>6?1:i.options.depth;var s=i.options.nested?i.options.headings.splice(i.options.startLevel-1,i.options.depth):i.options.headings;if(i.$headings=t(e).find(s.join(", ")).filter(function(){return 0===t(this).closest(i.options.ignoreContainers).length?!0:!1}),0!=i.$headings.length){if(i.options.topLinks!==!1){var p=t(document.body).attr("id");""==p&&(p=i.options.topBodyId,document.body.id=p),i.topLinkId=p}return i.$el.append("<"+i.options.containerType+" class='nav'>"+i.buildTOC()+"</"+i.options.containerType+">"),i}},i.buildTOC=function(){return i.current_depth=i.options.startLevel,i.$headings.each(function(t){var n=this.nodeName.toLowerCase();if(i.options.nested){var e=n.substr(1,1);(t>0||0==t&&e!=i.current_depth)&&i.addItem(e,t),i.html+=i.formatLink(this,e,t)+"\n"}else i.html+="<"+i.options.itemType+">\n"+i.formatLink(this,n,t)+"\n</"+i.options.itemType+">\n";i.options.topLinks!==!1&&i.addTopLink(this)}),i.addItem(i.options.startLevel,i.$headings.length),i.options.nested&&(i.html="<"+i.options.itemType+"  class=''>\n"+i.html+"</"+i.options.itemType+">\n"),i.html},i.addTopLink=function(n){var e=i.options.topLinks===!0?"Top":i.options.topLinks,o=t("<a href='#"+i.topLinkId+"' class='"+i.options.topLinkClass+"'></a>").html(e);t(n).append(o)},i.formatLink=function(n,e,o){var s=n.id;return""==s&&(s="toc-id-"+o,n.id=s),'<a href="#'+s+'" class="'+i.formatDepthClass(e)+'" >'+i.options.linkText.replace("%",t(n).text())+"</a>"},i.addItem=function(t,n){var e;if(t>i.current_depth)for(e=i.current_depth;t>e;e++)i.html+="<"+i.options.containerType+' class="nav">\n <'+i.options.itemType+">\n";else if(t<i.current_depth){for(e=i.current_depth;e>t;e--)i.html+="</"+i.options.itemType+">\n </"+i.options.containerType+">\n";i.$headings.length!=n&&(i.html+="</"+i.options.itemType+">\n<"+i.options.itemType+">\n")}else i.$headings.length!=n&&(i.html+="</"+i.options.itemType+">\n<"+i.options.itemType+">\n");i.current_depth=t},i.formatDepthClass=function(t){return i.options.nested?i.options.depthClass.replace("%",t-(i.options.startLevel-1)):i.options.depthClass.replace("%",t)},i.init(e,o)},t.TOC.defaultOptions={headings:["h1","h2"],startLevel:1,depth:3,depthClass:"toc-depth-%",linkText:"%",topLinks:!1,topLinkClass:"toc-link",topBodyId:"top",containerType:"ul",itemType:"li",nested:!0,ignoreContainers:""},t.fn.TOC=function(n,e){return this.each(function(){var o=new t.TOC(this,n,e);delete o})}}(jQuery);