diff -Nru cosmo_pompa.orig/cosmo/Options cosmo_pompa/cosmo/Options
--- cosmo_pompa.orig/cosmo/Options	2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options	2020-08-15 16:55:47.786166191 +0200
@@ -1,17 +1,12 @@
 # compiler
-F90      = ftn -D__CRAY_FORTRAN__
+F90      = ftn --cray-bypass-pkgconfig -D__CRAY_FORTRAN__ -homp -h system_alloc -add-rpath
 COMPILER = cray
 
 # linker
-LD       = $(F90)
+LD       = ftn --cray-bypass-pkgconfig
 
--include $(ROOT)/Options.$(COMPILER).cpu
+-include $(ROOT)/Options.$(COMPILER).gpu
+-include $(ROOT)/Options.lib.gpu
 
-#PFLAGS  += -DSINGLEPRECISION # run model in single precision
-
--include $(ROOT)/Options.lib.cpu
-
-# bit-repro math
-CMATH_DIR=/users/charpill/prg/mch/cmath
-FMATH_DIR=/users/charpill/prg/mch/fmath
-CC = CC
\ No newline at end of file
+# ensure usage of cray c++ when compiling C/C++ 
+CC = CC --cray-bypass-pkgconfig
diff -Nru cosmo_pompa.orig/cosmo/Options.cray.gpu cosmo_pompa/cosmo/Options.cray.gpu
--- cosmo_pompa.orig/cosmo/Options.cray.gpu	2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options.cray.gpu	2020-08-15 13:53:47.345711150 +0200
@@ -8,15 +8,12 @@
 FFLAGS  += -eI # treat all variables as if an implicit none is there
 FFLAGS  += -eF # control preprocessor expansion of macros
 #FFLAGS  += -hkeepfiles # keep .s files
-FFLAGS  += -hnosecond_underscore # symbol names only have one underscore
+FFLAGS  +=  # symbol names only have one underscore
 FFLAGS  += -hflex_mp=conservative # reasonably aggressive floating point optimizations
 FFLAGS  += -Ofp1 # require reasonably strong IEEE standard conformance
 FFLAGS  += -hadd_paren # automatically adds parenthesis to select associative operations
 FFLAGS  += -hacc # compile for GPU
 FFLAGS  += -ra # generates listing
-#MED 26/11/2019>>
-FFLAGS  += -h system_alloc -add-rpath
-#MED<<
 
 # verbose compilation flags
 VFLAGS   = -v # show compilation information
@@ -69,7 +66,7 @@
 # RFLAGS += -O0 
 RFLAGS += -O1
 RFLAGS += -eI 
-RFLAGS += -hnosecond_underscore 
+RFLAGS +=  
 RFLAGS += -hadd_paren 
 RFLAGS += -hfp0 
 # RFLAGS += -hflex_mp=intolerant 
diff -Nru cosmo_pompa.orig/cosmo/Options.lib.gpu cosmo_pompa/cosmo/Options.lib.gpu
--- cosmo_pompa.orig/cosmo/Options.lib.gpu	2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options.lib.gpu	2020-08-15 17:16:44.784238000 +0200
@@ -1,11 +1,8 @@
 # Options.lib.gpu
 
 # global libraries and includes
-LIB      = $(LDFLAGS)
-#MED 26/11/2019>>
-LIB     += -L/opt/nvidia/cudatoolkit10/10.0.130_3.22-7.0.1.0_5.2__gdfb4ce5/lib64 -lcudart -lcublas
-#MED<<
-INC      = -I.
+LIB      = -L/opt/cray/dmapp/default/lib64 -L/opt/cray/pe/libsci/20.06.1/CRAYCLANG/9.0/x86_64/lib -L/opt/cray/rca/2.2.20-7.0.2.1_2.27__g8e3fb5b.ari/lib64 -L$(CUDATOOLKIT_HOME)/lib64 -L$(CUDATOOLKIT_HOME)/extras/CUPTI/lib64 -L$(CUDATOOLKIT_HOME)/nvvm/lib64 -L/opt/cray/nvidia/default/lib64 -L/opt/cray/pe/atp/3.7.4/lib -Wl,--as-needed,-lcupti,-lcudart,-lcublas,--no-as-needed -lcuda  -lAtpSigHandler -Wl,-rpath,/opt/cray/pe/atp/3.7.4/lib -Wl,--undefined=__libAtpSigHandler_ctor -lrca -Wl,--as-needed,-lsci_cray_mpi,--no-as-needed -Wl,--as-needed,-lsci_cray,--no-as-needed 
+INC      = -I. -I/opt/cray/pe/libsci/20.06.1/CRAYCLANG/9.0/x86_64/include -I/opt/cray/pe/atp/3.7.4/include 
 INC     += -I$(ROOT)/$(SRCDIR)
 
 # optimized flags, libraries and includes
@@ -17,39 +14,37 @@
 DBGI     =
 
 # MPI library
-MPIL     =
-MPII     = -D__MPICH2
+MPIL     = -L/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/lib -Wl,--as-needed,-lmpich,--no-as-needed -Wl,--as-needed,-lmpichf90,--no-as-needed 
+MPII     = -D__MPICH2 -I/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/include
 
 # Grib1 library
-GRIBDWDL = -L$(INSTALL_DIR)/libgrib1 -lgrib1_$(COMPILER)
+GRIBDWDL = -L${EBROOTLIBGRIB1_CRCLIM} -lgrib1_cray
 GRIBDWDI =
 
 # Grib-API library
-GRIBAPI_VERSION = v1.20.0.2
-GRIBAPIL = -L$(INSTALL_DIR)/libgrib_api/$(GRIBAPI_VERSION)/$(COMPILER)/lib -lgrib_api_f90 -lgrib_api -L$(INSTALL_DIR)/libjasper/lib -ljasper
-GRIBAPII = -I$(INSTALL_DIR)/libgrib_api/$(GRIBAPI_VERSION)/$(COMPILER)/include
+# GRIBAPI_VERSION = v1.13.1
+GRIBAPIL = -L${EBROOTGRIB_API}/lib -lgrib_api_f90 -lgrib_api -L${EBROOTJASPER}/lib -ljasper
+GRIBAPII = -I${EBROOTGRIB_API}/include
 
 # NetCDF library
-NETCDFL  = 
-NETCDFI  = 
+NETCDFL  = -L/opt/cray/pe/netcdf/4.7.4.0/crayclang/9.0/lib -Wl,--as-needed,-lnetcdf,--no-as-needed -Wl,--as-needed,-lnetcdff,--no-as-needed
+NETCDFI  = -I/opt/cray/pe/netcdf/4.7.4.0/crayclang/9.0/include -I/opt/cray/pe/hdf5/1.12.0.0/crayclang/9.0/include
 
 # Synsat library
-RTTOV7L  = -L$(INSTALL_DIR)/librttov7 -lrttov7_$(COMPILER)
 RTTOV7I  =
 RTTOV10L =
 RTTOV10I =
 
 # Serialization library
-SERIALBOX  =
-SERIALBOXL =
-SERIALBOXI =
+SERIALBOX  = ${EBROOTSERIALBOX}
+SERIALBOXL = -L${EBROOTSERIALBOX}/lib
 
 # STELLA library
-STELLA   = $(STELLA_DIR)
-STELLAL  = -L$(STELLA)/lib -lCommunicationFrameworkCUDA -ljson -lStellaCUDA -lgcl -lStellaUtils -lSharedInfrastructureCUDA -lstdc++
-STELLAI  =
+STELLA   = ${EBROOTSTELLA}
+STELLAL  = -L${EBROOTSTELLA}/lib -lCommunicationFrameworkCUDA -ljson -lStellaCUDA -lgcl -lStellaUtils -lSharedInfrastructureCUDA -lstdc++
+STELLAI  = -I${EBROOTSTELLA}/include/STELLA
 
 # Dycore library
-DYCORE   = $(DYCORE_DIR)
-DYCOREL  = -L$(DYCORE)/lib -lDycoreWrapperCUDA -lDycoreCUDA
+DYCORE   = ${EBROOTDYCORE}
+DYCOREL  = -L${EBROOTDYCORE}/lib -lDycoreWrapperCUDA -lDycoreCUDA
 DYCOREI  =
