diff -Nru cosmo_pompa.orig/cosmo/Options cosmo_pompa/cosmo/Options
--- cosmo_pompa.orig/cosmo/Options	2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options	2020-08-14 20:03:38.574728000 +0200
@@ -1,17 +1,12 @@
 # compiler
-F90      = ftn -D__CRAY_FORTRAN__
+F90      = /opt/cray/pe/cce/10.0.2/cce/x86_64/bin/ftnfe -h cpu=haswell -h network=aries -D__CRAYXC -D__CRAY_HASWELL -D__CRAYXT_COMPUTE_LINUX_TARGET -D__CRAY_FORTRAN__ -homp -h system_alloc -add-rpath -L$(CUDATOOLKIT_HOME)/lib64 -lcudart -lcublas
 COMPILER = cray
 
 # linker
-LD       = $(F90)
+LD       = /opt/cray/pe/cce/10.0.2/binutils/x86_64/x86_64-pc-linux-gnu/bin/ld
 
--include $(ROOT)/Options.$(COMPILER).cpu
+-include $(ROOT)/Options.$(COMPILER).gpu
+-include $(ROOT)/Options.lib.gpu
 
-#PFLAGS  += -DSINGLEPRECISION # run model in single precision
-
--include $(ROOT)/Options.lib.cpu
-
-# bit-repro math
-CMATH_DIR=/users/charpill/prg/mch/cmath
-FMATH_DIR=/users/charpill/prg/mch/fmath
-CC = CC
\ No newline at end of file
+# ensure usage of cray c++ when compiling C/C++ 
+CC = /opt/cray/pe/cce/10.0.2/cce-clang/x86_64/bin/clang-10 -cc1 -triple x86_64-unknown-linux-gnu -mllvm -cray-omp-opt-fork-call -mllvm -cray-omp-parallel-opt-call -fcray-gpu -fcray-openmp-rename-outlined-funcs -mllvm -cray-openmp-rename-outlined -flocal-restrict -mllvm -cray-enhanced-asm=1 -fenhanced-asm=1 -mllvm -cray-enhanced-ir=1 -fenhanced-ir=1 -fomp-local-offload-table -ffortran -emit-obj -mrelax-all -disable-free -main-file-name test.cpp -mrelocation-model static -mthread-model posix -mframe-pointer=all -fmath-errno -fno-rounding-math -masm-verbose -mconstructor-aliases -munwind-tables -target-cpu haswell -dwarf-column-info -fno-split-dwarf-inlining -debugger-tuning=gdb -v -resource-dir /opt/cray/pe/cce/10.0.2/cce-clang/x86_64/lib/clang/10.0.0 -isystem /opt/cray/pe/cce/10.0.2/cce-clang/x86_64/lib/clang/10.0.0/include -isystem /opt/cray/pe/cce/10.0.2/cce/x86_64/include/craylibs -D __CRAYXC -D __CRAY_HASWELL -D __CRAYXT_COMPUTE_LINUX_TARGET
diff -Nru cosmo_pompa_orig/cosmo/Options.cray.gpu cosmo_pompa/cosmo/Options.cray.gpu
--- cosmo_pompa_orig/cosmo/Options.cray.gpu     2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options.cray.gpu  2019-11-29 16:39:57.000000000 +0100
@@ -14,9 +14,6 @@
 FFLAGS  += -hadd_paren # automatically adds parenthesis to select associative operations
 FFLAGS  += -hacc # compile for GPU
 FFLAGS  += -ra # generates listing
-#MED 26/11/2019>>
-FFLAGS  += -h system_alloc -add-rpath
-#MED<<

 # verbose compilation flags
 VFLAGS   = -v # show compilation information
diff -Nru cosmo_pompa.orig/cosmo/Options.lib.gpu cosmo_pompa/cosmo/Options.lib.gpu
--- cosmo_pompa.orig/cosmo/Options.lib.gpu	2019-11-29 09:56:39.000000000 +0100
+++ cosmo_pompa/cosmo/Options.lib.gpu	2020-08-14 19:59:30.294670000 +0200
@@ -1,11 +1,8 @@
 # Options.lib.gpu
 
 # global libraries and includes
-LIB      = $(LDFLAGS)
-#MED 26/11/2019>>
-LIB     += -L/opt/nvidia/cudatoolkit10/10.0.130_3.22-7.0.1.0_5.2__gdfb4ce5/lib64 -lcudart -lcublas
-#MED<<
-INC      = -I.
+LIB      = $(LDFLAGS) --eh-frame-hdr -m elf_x86_64 --enable-new-dtags --dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib64//crt1.o /usr/lib64//crti.o /opt/gcc/8.1.0/snos/lib/gcc/x86_64-suse-linux/8.1.0//crtbegin.o /opt/gcc/8.1.0/snos/lib/gcc/x86_64-suse-linux/8.1.0//crtfastmath.o /opt/cray/pe/cce/10.0.2/cce/x86_64/lib/no_mmap.o /tmp/pe_7778/test_1.o -Bdynamic -rpath=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib -L/opt/gcc/8.1.0/snos/lib64 -rpath=/opt/cray/pe/gcc-libs -L/opt/cray/dmapp/default/lib64 -L/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/lib -L/opt/cray/dmapp/default/lib64 -L/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/lib -L/opt/cray/pe/libsci/20.06.1/CRAYCLANG/9.0/x86_64/lib -L/opt/cray/pe/netcdf/4.7.4.0/crayclang/9.0/lib -L/opt/cray/rca/2.2.20-7.0.2.1_2.27__g8e3fb5b.ari/lib64 -L/opt/cray/pe/atp/3.7.4/lib -L/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/pkgconfig/../ -lAtpSigHandler -rpath /opt/cray/pe/atp/3.7.4/lib --undefined=__libAtpSigHandler_ctor -lrca --as-needed -lnetcdf --no-as-needed --as-needed -lnetcdff --no-as-needed --as-needed -lmpich_cray_90 --no-as-needed --as-needed -lmpichf90_cray_90 --no-as-needed --as-needed -lsci_cray_mpi --no-as-needed --as-needed -lsci_cray --no-as-needed --as-needed -lpgas-dmapp --no-as-needed -lquadmath -lmodules -lfi -lcraymath -lf -lu -lcsup --as-needed -lgfortran --no-as-needed -lstdc++ -lpthread -L/opt/cray/pe/cce/10.0.2/cce-clang/x86_64/lib/clang/10.0.0/lib/linux --start-group -lc -lcsup -lgcc_eh -lm -lclang_rt.craypgo-x86_64 -lgcc --end-group -lclang_rt.builtins-x86_64 -L /opt/gcc/8.1.0/snos/lib/gcc/x86_64-suse-linux/8.1.0 -L /opt/cray/pe/cce/10.0.2/binutils/x86_64/x86_64-pc-linux-gnu/..//x86_64-unknown-linux-gnu/lib -EL /opt/gcc/8.1.0/snos/lib/gcc/x86_64-suse-linux/8.1.0//crtend.o /usr/lib64//crtn.o
+INC      = -I. -I/opt/cray/pe/cce/10.0.2/cce-clang/x86_64/lib/clang/10.0.0/include -I/opt/cray/pe/cce/10.0.2/cce/x86_64/include/craylibs -I/usr/include -I/usr/include -I/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/include -I/opt/cray/pe/libsci/20.06.1/CRAYCLANG/9.0/x86_64/include -I/opt/cray/pe/netcdf/4.7.4.0/crayclang/9.0/include -I/opt/cray/pe/hdf5/1.12.0.0/crayclang/9.0/include -I/opt/cray/rca/2.2.20-7.0.2.1_2.27__g8e3fb5b.ari/include -I/opt/cray/alps/6.6.59-7.0.2.1_3.14__g872a8d62.ari/include -I/opt/cray/xpmem/2.2.20-7.0.2.1_2.21__g87eb960.ari/include -I/opt/cray/gni-headers/5.0.12.0-7.0.2.1_2.5__g3b1768f.ari/include -I/opt/cray/dmapp/7.1.1-7.0.2.1_2.26__g38cf134.ari/include -I/opt/cray/pe/pmi/5.0.16/include -I/opt/cray/ugni/6.0.14.0-7.0.2.1_3.21__ge78e5b0.ari/include -I/opt/cray/udreg/2.3.2-7.0.2.1_2.21__g8175d3d.ari/include -I/opt/cray/pe/atp/3.7.4/include -I/opt/cray/wlm_detect/1.3.3-7.0.2.1_2.7__g7109084.ari/include -I/opt/cray/krca/2.2.7-7.0.2.1_2.22__ge897ee1.ari/include -I/opt/cray-hss-devel/9.0.0/include -hpl=/tmp/pe_7778//pldir -usystem_mod=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/libmodules.a -usystem_mod=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/libomp.a -usystem_mod=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/omp_lib.a -usystem_mod=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/libopenacc.a -usystem_mod=/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/include -usystem_mod=/opt/cray/pe/libsci/20.06.1/CRAYCLANG/9.0/x86_64/include -usystem_mod=/opt/cray/pe/netcdf/4.7.4.0/crayclang/9.0/include -usystem_mod=/opt/cray/pe/hdf5/1.12.0.0/crayclang/9.0/include -usystem_mod=/opt/cray/rca/2.2.20-7.0.2.1_2.27__g8e3fb5b.ari/include -usystem_mod=/opt/cray/alps/6.6.59-7.0.2.1_3.14__g872a8d62.ari/include -usystem_mod=/opt/cray/xpmem/2.2.20-7.0.2.1_2.21__g87eb960.ari/include -usystem_mod=/opt/cray/gni-headers/5.0.12.0-7.0.2.1_2.5__g3b1768f.ari/include -usystem_mod=/opt/cray/dmapp/7.1.1-7.0.2.1_2.26__g38cf134.ari/include -usystem_mod=/opt/cray/pe/pmi/5.0.16/include -usystem_mod=/opt/cray/ugni/6.0.14.0-7.0.2.1_3.21__ge78e5b0.ari/include -usystem_mod=/opt/cray/udreg/2.3.2-7.0.2.1_2.21__g8175d3d.ari/include -usystem_mod=/opt/cray/pe/atp/3.7.4/include -usystem_mod=/opt/cray/wlm_detect/1.3.3-7.0.2.1_2.7__g7109084.ari/include -usystem_mod=/opt/cray/krca/2.2.7-7.0.2.1_2.22__ge897ee1.ari/include -usystem_mod=/opt/cray-hss-devel/9.0.0/include -usystem_mod=/opt/cray/pe/cce/10.0.2/cce/x86_64/lib/libcraymp.a -udv -ffree -CZ/tmp/pe_7778/test.T -Cx -CX/tmp/pe_7778/test.xml -hdecompile=/users/lucamar/test. -S /tmp/pe_7778/test_1.s -Oipa3 -uo=/tmp/pe_7778/test.o -ufile_id=1
 INC     += -I$(ROOT)/$(SRCDIR)
 
 # optimized flags, libraries and includes
@@ -17,39 +14,38 @@
 DBGI     =
 
 # MPI library
-MPIL     =
-MPII     = -D__MPICH2
+MPIL     = -L/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/lib -lmpichf90_cray_90 -lmpich_cray_90
+MPII     = -D__MPICH2 -I/opt/cray/pe/mpt/7.7.15/gni/mpich-cray/9.0/include
 
 # Grib1 library
-GRIBDWDL = -L$(INSTALL_DIR)/libgrib1 -lgrib1_$(COMPILER)
+GRIBDWDL = -L${EBROOTLIBGRIB1_CRCLIM} -lgrib1_cray
 GRIBDWDI =
 
 # Grib-API library
-GRIBAPI_VERSION = v1.20.0.2
-GRIBAPIL = -L$(INSTALL_DIR)/libgrib_api/$(GRIBAPI_VERSION)/$(COMPILER)/lib -lgrib_api_f90 -lgrib_api -L$(INSTALL_DIR)/libjasper/lib -ljasper
-GRIBAPII = -I$(INSTALL_DIR)/libgrib_api/$(GRIBAPI_VERSION)/$(COMPILER)/include
+# GRIBAPI_VERSION = v1.13.1
+GRIBAPIL = -L${EBROOTGRIB_API}/lib -lgrib_api_f90 -lgrib_api -L${EBROOTJASPER}/lib -ljasper
+GRIBAPII = -I${EBROOTGRIB_API}/include
 
 # NetCDF library
-NETCDFL  = 
-NETCDFI  = 
+NETCDFL  = -L${NETCDF_DIR}/lib
+NETCDFI  = -I${NETCDF_DIR}/include
 
 # Synsat library
-RTTOV7L  = -L$(INSTALL_DIR)/librttov7 -lrttov7_$(COMPILER)
+#RTTOV7L  = -L$(INSTALL_DIR)/librttov7 -lrttov7_$(COMPILER)
 RTTOV7I  =
 RTTOV10L =
 RTTOV10I =
 
 # Serialization library
-SERIALBOX  =
-SERIALBOXL =
-SERIALBOXI =
+SERIALBOX  = ${EBROOTSERIALBOX}
+SERIALBOXL = -L${EBROOTSERIALBOX}/lib
 
 # STELLA library
-STELLA   = $(STELLA_DIR)
-STELLAL  = -L$(STELLA)/lib -lCommunicationFrameworkCUDA -ljson -lStellaCUDA -lgcl -lStellaUtils -lSharedInfrastructureCUDA -lstdc++
-STELLAI  =
+STELLA   = ${EBROOTSTELLA}
+STELLAL  = -L${EBROOTSTELLA}/lib -lCommunicationFrameworkCUDA -ljson -lStellaCUDA -lgcl -lStellaUtils -lSharedInfrastructureCUDA -lstdc++
+STELLAI  = -I${EBROOTSTELLA}/include/STELLA
 
 # Dycore library
-DYCORE   = $(DYCORE_DIR)
-DYCOREL  = -L$(DYCORE)/lib -lDycoreWrapperCUDA -lDycoreCUDA
+DYCORE   = ${EBROOTDYCORE}
+DYCOREL  = -L${EBROOTDYCORE}/lib -lDycoreWrapperCUDA -lDycoreCUDA
 DYCOREI  =
