# jg (cscs)
easyblock = 'CMakeMake'

name = 'otf2_cli_profile'
version = '9be64de'
homepage = 'https://github.com/score-p/otf2_cli_profile.git'
description = "Tool to read otf2 trace files"
toolchain = {'name': 'CrayGNU', 'version': '20.06'}
toolchainopts = {'dynamic': True, 'verbose': False}
sources = [{
    'filename': SOURCE_TAR_GZ,
    'git_config': {
        'url': 'https://github.com/score-p',
        'repo_name': '%s' % name,
        'commit': '%s' % version,
    },
}]
# patches = ['%(name)s-%(version)s.patch']
builddependencies = [('CMake', '3.14.5', '', True)]
dependencies = [ 
    ('rapidjson', 'f56928d', '', True),
    ('OTF2', '2.2', '', True),
    ('CubeLib', '4.5'),
]
configopts  = ' -DUSE_JSON=ON -DUSE_MPI=ON'
configopts += ' -DRAPIDJSON_INCLUDE_DIRS=$EBROOTRAPIDJSON/include'
configopts += ' -DCUBE_INC_DIR=$EBROOTCUBELIB/include'
configopts += ' -DCUBE_LIB_DIR=$EBROOTCUBELIB/lib'
configopts += ' -DCUBE_LIB=$EBROOTCUBELIB/lib/libcube4.so'
configopts += ' -DCMAKE_BUILD_TYPE=RELEASE'
configopts += ' -DCMAKE_CXX_FLAGS=-fpermissive'
configopts += ' -DOTF2_INCLUDE_DIRS=$EBROOTOTF2/include'
# configopts += ' -DRAPIDJSON_INCLUDE_DIRS=`pkg-config --variable=includedir RapidJSON`'
separate_build_dir = 'True'
postinstallcmds = [
    'cp -a otf-profiler-mpi %(installdir)s/bin',
    'mkdir -p %(installdir)s/include',
    'cp otf-profiler-config.h %(installdir)s/include',
]
sanity_check_paths = {
    'files': ['bin/otf-profiler', 'bin/otf-profiler-mpi'],
    'dirs': ['include'],
}

moduleclass = 'perf'
